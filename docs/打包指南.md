# Windsurf Account Manager 打包指南

## 打包步骤
运行脚本命令！！！

.\build_with_admin.bat

### 步骤1：构建前端

```powershell
cd d:\CursorWork\windsurf-account-manager-simple
npm run build
```

**验证**：确认 `dist` 目录包含以下内容：
- `index.html`
- `assets/` 目录（含 JS 和 CSS 文件）

### 步骤2：打包 Tauri 应用（需要管理员权限）

```powershell
# 以管理员身份运行 PowerShell
cd d:\CursorWork\windsurf-account-manager-simple
npm run tauri build
```

### 步骤3：获取安装包

构建完成后，安装包位于：

| 类型 | 路径 |
|------|------|
| NSIS (.exe) | `src-tauri\target\release\bundle\nsis\windsurf-account-manager_x.x.x_x64-setup.exe` |
| MSI (.msi) | `src-tauri\target\release\bundle\msi\windsurf-account-manager_x.x.x_x64_zh-CN.msi` |

---

## 一键打包脚本

创建 `build.ps1`，以**管理员身份**运行：

```powershell
# 切换到项目目录
cd d:\CursorWork\windsurf-account-manager-simple

# 步骤1：构建前端
Write-Host "正在构建前端..." -ForegroundColor Cyan
npm run build
if ($LASTEXITCODE -ne 0) {
    Write-Host "前端构建失败！" -ForegroundColor Red
    exit 1
}

# 验证 dist/index.html 存在
if (-not (Test-Path "dist\index.html")) {
    Write-Host "错误：dist/index.html 不存在！" -ForegroundColor Red
    exit 1
}
Write-Host "前端构建成功！" -ForegroundColor Green

# 步骤2：打包 Tauri
Write-Host "正在打包 Tauri 应用..." -ForegroundColor Cyan
npm run tauri build
if ($LASTEXITCODE -ne 0) {
    Write-Host "Tauri 打包失败！" -ForegroundColor Red
    exit 1
}

Write-Host "打包完成！" -ForegroundColor Green
Write-Host "安装包位置：" -ForegroundColor Yellow
Get-ChildItem "src-tauri\target\release\bundle\nsis\*.exe" | Select-Object FullName
Get-ChildItem "src-tauri\target\release\bundle\msi\*.msi" | Select-Object FullName
```

---

## 常见问题

### 问题1：`asset not found: index.html`

**原因**：前端未构建或构建失败

**解决**：
1. 先运行 `npm run build`
2. 确认 `dist/index.html` 存在
3. 再运行 `npm run tauri build`

### 问题2：`请求的操作需要提升 (os error 740)`

**原因**：需要管理员权限

**解决**：以管理员身份运行 PowerShell

### 问题3：MSI 安装时警告 1909

**原因**：创建快捷方式权限问题

**解决**：点击"确定"继续，不影响使用

---

## 注意事项

1. **顺序很重要**：必须先构建前端，再打包 Tauri
2. **管理员权限**：Tauri 打包需要管理员权限
3. **清理缓存**（可选）：如遇问题，可删除 `dist` 目录后重新构建
